import{m as y}from"./VGrid-b88c7bb8.js";import{r as M,o as f,c as U,a as s,w as t,G as B,E as J,b as r,i as V,e as h,F as R,h as b,V as x,t as v,M as C,d as D,f as w,a2 as q,H as E,I as K}from"./main-bfac9f8c.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";import{V as N}from"./VOverlay-7eeede3f.js";import{V as j,d as m,a as O,e as z,b as H,c as A}from"./VRow-ccc808b6.js";import{V as G,a as k}from"./VTabs-19d00ced.js";import{V as Y,a as W}from"./VWindowItem-fb5868fd.js";import{V as Q}from"./VSpacer-e49be368.js";import{a as _,V as X}from"./VTextField-44b53add.js";import{V as T}from"./VTooltip-2344745c.js";import{V as Z}from"./VDialog-e03e48c3.js";import{V as g}from"./VFileInput-1291150c.js";import{V as P}from"./VDivider-4be0732b.js";import{V as S}from"./VCheckbox-9539166c.js";import"./VImg-c6e6a04c.js";import"./index-870468d1.js";import"./VInput-8311a828.js";import"./dialog-transition-72403d3a.js";import"./VChip-b5c7760f.js";import"./VCheckboxBtn-4c5fc937.js";const $={data(){return{monthYear:this.$route.params.monthYear,overlay:!1,insert:!1,searchValue:"",userData:null,userToken:null,uploadProgress:null,tab:0,rules:{required:l=>!!l||"Required"},role:[],items:[],originalItems:[],headers:[{text:"Nama",value:"name",sortable:!0},{text:"Plafon",value:"plafon",sortable:!0},{text:"Status",value:"isApproved",sortable:!0},{text:"AO/RO",value:"aoro",sortable:!0},{text:"Tanggal",value:"created_at",sortable:!0},{text:"Operation",value:"operation",width:100}],phases:[{value:0},{value:1},{value:2},{value:3},{value:4}],dataForm:{id:null,name:"",plafon:null,type_bussiness:null,desc_bussiness:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}}},watch:{tab(l){l==1?this.filterDataStatus(1):l==2?this.filterDataStatus(2):l==3?this.filterDataStatus(3):this.items=[...this.originalItems]}},methods:{goBack(){this.$router.go(-1)},formatDate(l){return new Date(l).toLocaleString("id-ID")},async downloadFile(l){try{this.overlay=!0;const e=await y.get(`/download-all/${l}`,{responseType:"blob"});if(e.status===200){this.overlay=!1;const u=window.URL.createObjectURL(new Blob([e.data])),d=document.createElement("a");d.href=u,d.setAttribute("download",`${l}.zip`),document.body.appendChild(d),d.click(),document.body.removeChild(d),this.$showToast("success","Berhasil","File berhasil diunduh")}else this.overlay=!1,this.$showToast("error","Error","Gagal mengunduh file")}catch{this.overlay=!1,this.$showToast("error","Error","Terjadi kesalahan saat mengunduh file")}},toDetail(l){this.$router.push(`/a-credit/${l.id}`)},async deleteFile(l){try{if(!window.confirm("Apakah Anda yakin ingin menghapus data? Semua Data akan terhapus secara permanen."))return;const u=await y.delete(`/credit/${l.id}`);u.status===200?(this.getAllFiles(),this.$showToast("success","Berhasill",u.data.message)):this.$showToast("error","Sorry",u.data.message)}catch(e){this.$showToast("error","Sorry",e.response.data.message)}},resetFile(l){!this.dataForm[l]!=null&&(this.dataForm[l]=null)},handleFileChange(l,e){const u=l.target.files[0];u&&["image/jpeg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(u.type)?(this.dataForm[e]=u,e=="file1"?this.dataForm.noteFile1="KTP Pemohon":e=="file2"?this.dataForm.noteFile2="KTP Pasangan":e=="file3"?this.dataForm.noteFile3="KTP Atas Nama Jaminan":e=="file4"?this.dataForm.noteFile4="Kartu Keluarga":e=="file5"?this.dataForm.noteFile5="Buku Nikah":e=="file7"?this.dataForm.noteFile7="Jaminan SHM":e=="file8"?this.dataForm.noteFile8="Jaminan BPKB":e=="file9"?this.dataForm.noteFile9="Foto Detail Mesin":e=="file10"&&(this.dataForm.noteFile10="Foto Kunjungan")):(this.$showToast("error","Error","Hanya file JPG, JPEG, dan PNG yang diizinkan."),l.target.value=null)},async getRecaptData(l){try{this.overlay=!0;const e=await y.get(`/generatemonthly/${l}`,{responseType:"blob"});if(e.status===200){this.overlay=!1;const u=e.headers["content-disposition"];let d="download.xlsx";if(u){const o=u.match(/filename="?(.+)"?/i);o.length===2&&(d=o[1])}const a=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.setAttribute("download",d),document.body.appendChild(c),c.click(),document.body.removeChild(c),this.$showToast("success","Berhasil","File Excel berhasil diunduh")}else this.$showToast("error","Sorry",e.data.data.message)}catch(e){this.overlay=!1,this.$showToast("error","Sorry",e.response.data.message)}},async openModal(l,e=null){l===1?this.insert=!0:l===2&&this.getRecaptData(this.monthYear)},closeModal(l){l===1?(this.resetForm(),this.insert=!1):l===2&&(this.resetForm(),this.edit=!1)},resetForm(){this.dataForm={id:null,name:"",plafon:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}},formatInput(l){return l=l.replace(/\D/g,""),l=l.replace(/\B(?=(\d{3})+(?!\d))/g,","),l},filterDataStatus(l){this.items=this.originalItems.filter(e=>e.isApproved==l)},getUserData(){const l=localStorage.getItem("userData");l&&(this.userData=JSON.parse(l))},async getAllFiles(){try{this.overlay=!0;const l=new FormData;l.append("monthYear",this.monthYear);const e=await y.post("/getCredit",l);e.status===200?(this.items=e.data.data.files,this.originalItems=[...this.items],this.overlay=!1):this.$showToast("error","Sorry",e.data.data.message)}catch(l){this.overlay=!1,this.$showToast("error","Sorry",l.response.data.message)}},formatInputPlafon(l){let e=l.target.value;e=e.replace(/\D/g,""),e=e.replace(/\B(?=(\d{3})+(?!\d))/g,","),l.target.value=e},async insertData(){try{this.overlay=!0;const l=new FormData;l.append("name",this.dataForm.name),l.append("plafon",this.dataForm.plafon.replace(/\D/g,"")),l.append("type_bussiness",this.dataForm.type_bussiness),l.append("desc_bussiness",this.dataForm.desc_bussiness);for(let d=1;d<=10;d++){if(d===6)continue;let a="file"+d,i="noteFile"+d,c="hasFile"+d;this.dataForm.hasOwnProperty(c)&&this.dataForm[c]||this.dataForm[a]?this.dataForm[a]&&(l.append(a,this.dataForm[a]),l.append(i,this.dataForm[i])):this.dataForm[a]&&l.append(a,this.dataForm[a])}if(!this.dataForm.file7&&!this.dataForm.file8&&!this.dataForm.file9){this.overlay=!1,this.$showToast("success","Success","Wajib memasukkan salah satu jenis jaminan");return}l.append("_method","POST");const e={onUploadProgress:d=>{try{this.uploadProgress=Math.round(d.loaded*100/d.total)}catch(a){console.error("Error calculating progress:",a)}},headers:{"Content-Type":"multipart/form-data"}},u=await y.post("/credit",l,e);u.status===200?(this.overlay=!1,this.closeModal(1),this.getAllFiles(),this.uploadProgress=null,this.$showToast("success","Success",u.data.message)):(this.overlay=!1,this.uploadProgress=null,this.getAllFiles(),this.$showToast("error","Sorry",u.data.message))}catch(l){this.overlay=!1,this.uploadProgress=null,this.closeModal(1),this.getAllFiles(),this.$showToast("error","Sorry",l.response.data.message)}}},mounted(){this.getAllFiles(),this.getUserData()}};const n=l=>(E("data-v-ee3d0f66"),l=l(),K(),l),ee=n(()=>r("br",null,null,-1)),ae=n(()=>r("span",{class:"font-weight-bold text-lg"},"Loading....",-1)),le=n(()=>r("p",null,"Data Kosong",-1)),se=n(()=>r("p",null,"loading data .....",-1)),te={class:"operation-wrapper"},oe={class:"d-flex justify-space-between"},re=["onClick"],ie=["onClick"],ne=["onClick"],de=n(()=>r("span",{style:{color:"red"}},"*",-1)),ue=n(()=>r("span",{class:"subtitle-1 text-center"},"Nama Pemohon: ",-1)),me=n(()=>r("span",{style:{color:"red"}},"*",-1)),pe=n(()=>r("span",{class:"subtitle-1 text-center"},"Jumlah Plafon: ",-1)),he=n(()=>r("span",{style:{color:"red"}},"*",-1)),ce=n(()=>r("span",{class:"subtitle-1 text-center"},"KTP Pemohon : ",-1)),fe=n(()=>r("span",{style:{color:"red"}},"*",-1)),ge=n(()=>r("span",{class:"subtitle-1 text-center"},"Kartu Keluarga : ",-1)),Fe=n(()=>r("span",{style:{color:"red"}},"*",-1)),ye=n(()=>r("span",{class:"subtitle-1 text-center"},"Foto Kunjungan : ",-1)),be=n(()=>r("span",{style:{color:"red"}},"*",-1)),_e=n(()=>r("span",{class:"subtitle-1 text-center"},"KTP Pasangan Pemohon : ",-1)),Ve=n(()=>r("span",{style:{color:"red"}},"*",-1)),ve=n(()=>r("span",{class:"subtitle-1 text-center"},"Buku Nikah : ",-1)),we=n(()=>r("span",{style:{color:"red"}},"*",-1)),ke=n(()=>r("span",{class:"subtitle-1 text-center"},"KTP atas nama Jaminan : ",-1)),xe=n(()=>r("span",{style:{color:"red"}},"*",-1)),Ce=n(()=>r("span",{class:"subtitle-1 text-center"},"Jenis Usaha: ",-1)),De=n(()=>r("span",{style:{color:"red"}},"*",-1)),Te=n(()=>r("span",{class:"subtitle-1 text-center"},"Deskripsi Usaha: ",-1)),Pe=n(()=>r("span",{style:{color:"red"}},"*",-1)),Se=n(()=>r("span",{class:"subtitle-1 text-center"},"Lampirkan Salah Satu Jenis Jaminan : ",-1)),Ie=n(()=>r("span",{style:{color:"red"}},"*",-1)),Ue=n(()=>r("span",{class:"subtitle-1 text-center"},"Jaminan SHM : ",-1));function Be(l,e,u,d,a,i){const c=M("EasyDataTable");return f(),U(B,null,[s(N,{absolute:!0,modelValue:a.overlay,"onUpdate:modelValue":e[0]||(e[0]=o=>a.overlay=o),contained:"",persistent:"",class:"align-center justify-center"},{default:t(()=>[s(m,null,{default:t(()=>[s(J,{color:"primary",size:"32",indeterminate:""}),ee,ae]),_:1})]),_:1},8,["modelValue"]),s(j,null,{default:t(()=>[s(O,{class:"align-left"},{default:t(()=>[r("span",{color:"primary",onClick:e[1]||(e[1]=(...o)=>i.goBack&&i.goBack(...o)),style:{cursor:"pointer"}},[s(V,{icon:"bx-arrow-back",color:"primary",tag:"back",start:""}),h(" Back ")]),s(z,{class:"text-2xl font-weight-bold"},{default:t(()=>[h(" List Kredit ")]),_:1})]),_:1}),s(G,{modelValue:a.tab,"onUpdate:modelValue":e[2]||(e[2]=o=>a.tab=o),class:"v-tabs-pill","bg-color":"secondary"},{default:t(()=>[s(k,{value:"0"},{default:t(()=>[h("Semua")]),_:1}),s(k,{value:"1"},{default:t(()=>[h("Approved")]),_:1}),s(k,{value:"2"},{default:t(()=>[h("Pending")]),_:1}),s(k,{value:"3"},{default:t(()=>[h("Rejected")]),_:1})]),_:1},8,["modelValue"]),s(H,null,{default:t(()=>[s(Y,{modelValue:a.tab,"onUpdate:modelValue":e[8]||(e[8]=o=>a.tab=o)},{default:t(()=>[(f(!0),U(B,null,R(a.phases,o=>(f(),b(W,{value:o.value},{default:t(()=>[s(A,{class:"d-flex justify-end pa-3"},{default:t(()=>[s(x,{color:"primary",size:"small",class:"my-3 mx-3",onClick:e[3]||(e[3]=p=>i.openModal(1))},{default:t(()=>[h(" Tambah Data ")]),_:1}),s(x,{color:"primary",size:"small",class:"my-3 mx-3",onClick:e[4]||(e[4]=p=>i.openModal(2))},{default:t(()=>[h(" Rekap Data ")]),_:1}),s(Q),s(_,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:a.searchValue,"onUpdate:modelValue":e[5]||(e[5]=p=>a.searchValue=p)},null,8,["modelValue"])]),_:1}),r("div",{class:"table-container",onTouchstart:e[6]||(e[6]=D(()=>{},["stop"])),onTouchmove:e[7]||(e[7]=D(()=>{},["stop"]))},[s(c,{"show-index":"",headers:a.headers,items:a.items,"search-value":a.searchValue},{"empty-message":t(()=>[le]),loading:t(()=>[se]),"item-plafon":t(p=>[h("Rp. "+v(i.formatInput(p.plafon))+",-",1)]),"item-isApproved":t(p=>[h(v(parseInt(p.isApproved)==1?"Approved":parseInt(p.isApproved)==2?"Pending":"Rejected"),1)]),"item-aoro":t(p=>[r("span",null,v(p.user.name),1)]),"item-created_at":t(p=>[r("span",null,v(i.formatDate(p.created_at))+" WIB",1)]),"item-operation":t(p=>[r("div",te,[r("div",oe,[s(T,{location:"top",text:"Detail Kredit"},{activator:t(({props:F})=>[r("button",C(F,{onClick:I=>i.toDetail(p)}),[s(V,{size:"20",icon:"bx-link-external",color:"blue"})],16,re)]),_:2},1024),s(T,{location:"top",text:"Hapus Kredit"},{activator:t(({props:F})=>[r("button",C(F,{onClick:I=>i.deleteFile(p)}),[s(V,{size:"20",icon:"bx-trash",color:"blue"})],16,ie)]),_:2},1024),s(T,{location:"top",text:"Download Semua File Kredit"},{activator:t(({props:F})=>[r("button",C(F,{onClick:I=>i.downloadFile(p.id)}),[s(V,{size:"20",icon:"bx-download",color:"red"})],16,ne)]),_:2},1024)])])]),_:1},8,["headers","items","search-value"])],32)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),s(Z,{modelValue:a.insert,"onUpdate:modelValue":e[28]||(e[28]=o=>a.insert=o),width:"auto",persistent:"",transition:"dialog-top-transition"},{default:t(()=>[s(j,null,{title:t(()=>[h(" Tambah Data ")]),text:t(()=>[s(X,{onSubmit:D(i.insertData,["prevent"])},{default:t(()=>[s(A,null,{default:t(()=>[s(m,{md:"12",cols:"12"},{default:t(()=>[de,ue,s(_,{class:"my-3",modelValue:a.dataForm.name,"onUpdate:modelValue":e[9]||(e[9]=o=>a.dataForm.name=o),autofocus:"",rules:[a.rules.required]},null,8,["modelValue","rules"])]),_:1}),s(m,{md:"12",cols:"12"},{default:t(()=>[me,pe,s(_,{class:"my-3",modelValue:a.dataForm.plafon,"onUpdate:modelValue":e[10]||(e[10]=o=>a.dataForm.plafon=o),type:"text",onInput:i.formatInputPlafon},null,8,["modelValue","onInput"])]),_:1}),s(m,{md:"12",cols:"12"},{default:t(()=>[he,ce,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[11]||(e[11]=o=>i.handleFileChange(o,"file1"))},null,8,["rules"])]),_:1}),s(m,{md:"12",cols:"12"},{default:t(()=>[fe,ge,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[12]||(e[12]=o=>i.handleFileChange(o,"file4"))},null,8,["rules"])]),_:1}),s(m,{md:"12",cols:"12"},{default:t(()=>[Fe,ye,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[13]||(e[13]=o=>i.handleFileChange(o,"file10"))},null,8,["rules"])]),_:1}),s(P,{thickness:5}),s(m,{cols:"12",md:"12"},{default:t(()=>[s(S,{modelValue:a.dataForm.hasFile2,"onUpdate:modelValue":e[14]||(e[14]=o=>a.dataForm.hasFile2=o),label:"Apakah pemohon sudah menikah?",onChange:e[15]||(e[15]=o=>(i.resetFile("file2"),i.resetFile("file5")))},null,8,["modelValue"])]),_:1}),s(P,{thickness:5}),a.dataForm.hasFile2?(f(),b(m,{key:0,md:"12",cols:"12"},{default:t(()=>[be,_e,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[16]||(e[16]=o=>i.handleFileChange(o,"file2"))},null,8,["rules"])]),_:1})):w("",!0),a.dataForm.hasFile2?(f(),b(m,{key:1,md:"12",cols:"12"},{default:t(()=>[Ve,ve,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[17]||(e[17]=o=>i.handleFileChange(o,"file5"))},null,8,["rules"])]),_:1})):w("",!0),s(m,{cols:"12",md:"12"},{default:t(()=>[s(S,{modelValue:a.dataForm.hasFile3,"onUpdate:modelValue":e[18]||(e[18]=o=>a.dataForm.hasFile3=o),label:"Apakah agunan bukan atas nama pemohon?",onChange:e[19]||(e[19]=o=>i.resetFile("file3"))},null,8,["modelValue"])]),_:1}),a.dataForm.hasFile3?(f(),b(m,{key:2,md:"12",cols:"12"},{default:t(()=>[we,ke,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[20]||(e[20]=o=>i.handleFileChange(o,"file3"))},null,8,["rules"])]),_:1})):w("",!0),s(P,{thickness:5}),s(m,{md:"12",cols:"12"},{default:t(()=>[xe,Ce,s(_,{class:"my-3",modelValue:a.dataForm.type_bussiness,"onUpdate:modelValue":e[21]||(e[21]=o=>a.dataForm.type_bussiness=o),rules:[a.rules.required]},null,8,["modelValue","rules"])]),_:1}),s(m,{md:"12",cols:"12"},{default:t(()=>[De,Te,s(_,{class:"my-3",modelValue:a.dataForm.desc_bussiness,"onUpdate:modelValue":e[22]||(e[22]=o=>a.dataForm.desc_bussiness=o),rules:[a.rules.required]},null,8,["modelValue","rules"])]),_:1}),s(m,null,{default:t(()=>[Pe,Se]),_:1}),s(m,{cols:"12",md:"12"},{default:t(()=>[s(S,{modelValue:a.dataForm.hasFile7,"onUpdate:modelValue":e[23]||(e[23]=o=>a.dataForm.hasFile7=o),label:"Jenis Jaminan SHM ?",onChange:e[24]||(e[24]=o=>i.resetFile("file7"))},null,8,["modelValue"])]),_:1}),a.dataForm.hasFile7?(f(),b(m,{key:3,md:"12",cols:"12"},{default:t(()=>[Ie,Ue,s(g,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[a.rules.required],onChange:e[25]||(e[25]=o=>i.handleFileChange(o,"file7"))},null,8,["rules"])]),_:1})):w("",!0),s(m,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:t(()=>[s(x,{type:"submit",disabled:a.dataForm.hasFile2&&(a.dataForm.file2==null||a.dataForm.file5==null)||a.dataForm.hasFile3&&a.dataForm.file3==null||a.dataForm.hasFile7&&a.dataForm.file7==null||a.dataForm.hasFile8&&a.dataForm.file8==null||a.dataForm.hasFile9&&a.dataForm.file9==null||a.dataForm.file7==null&&a.dataForm.file8==null&&a.dataForm.file9==null||a.dataForm.type_bussiness==null&&a.dataForm.desc_bussiness==null},{default:t(()=>[h(" Simpan ")]),_:1},8,["disabled"]),r("button",{type:"button",class:"btn btn-blue",onClick:e[26]||(e[26]=o=>i.closeModal(1))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),actions:t(()=>[s(q,{modelValue:a.uploadProgress,"onUpdate:modelValue":e[27]||(e[27]=o=>a.uploadProgress=o),color:"amber",height:"25"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}const ea=L($,[["render",Be],["__scopeId","data-v-ee3d0f66"]]);export{ea as default};
