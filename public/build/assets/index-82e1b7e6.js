import{m as b}from"./index-7fea880e.js";import{r as S,o as m,c as F,a,w as o,G as P,E as A,e as h,F as U,h as g,V as x,f,t as I,b as i,i as C,d as j,a0 as J}from"./main-50364cd1.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{V as q}from"./VOverlay-ecef7f78.js";import{V as D,d as n,e as M,b as N,c as T}from"./VRow-61790f64.js";import{V as K,a as V}from"./VTabs-632b09b9.js";import{V as E,a as L,b as c}from"./VWindowItem-b7a8cb8b.js";import{V as R}from"./VSpacer-b6b06d50.js";import{a as _,V as z}from"./VTextField-f4a2aed6.js";import{V as O}from"./VDialog-ea0ecbb0.js";import{V as k}from"./VDivider-4c809598.js";import{V as v}from"./VCheckbox-86421adc.js";import"./VImg-5377d243.js";import"./VChip-02448860.js";import"./dialog-transition-0b1f9012.js";import"./VCheckboxBtn-2c4f795f.js";const G={data(){return{overlay:!1,insert:!1,searchValue:"",userData:null,userToken:null,uploadProgress:null,tab:0,rules:{required:l=>!!l||"Required"},items:[],originalItems:[],userAccess:null,headers:[{text:"Nama",value:"name",sortable:!0},{text:"Plafon",value:"plafon",sortable:!0},{text:"Status",value:"isApproved",sortable:!0},{text:"Operation",value:"operation"}],phases:[{value:0},{value:1},{value:2},{value:3},{value:4}],dataForm:{id:null,name:"",plafon:null,type_bussiness:null,desc_bussiness:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null},isStatusPhase:!1,statusPhase:0}},watch:{tab(l){l==1?this.filterDataStatus(1):l==2?this.filterDataStatus(2):l==3?this.filterDataStatus(3):this.items=[...this.originalItems]}},methods:{toDetail(l){this.$router.push(`/u-credit/${l.id}`)},async deleteFile(l){try{if(!window.confirm("Apakah Anda yakin ingin menghapus data? Semua Data akan terhapus secara permanen."))return;const u=await b.delete(`/user/credit/${l.id}`);u.status===200?(this.getAllFiles(),this.$showToast("success","Berhasil",u.data.message)):this.$showToast("error","Sorry",u.data.message)}catch(e){this.$showToast("error","Sorry",e.response.data.message)}},resetFile(l){!this.dataForm[l]!=null&&(this.dataForm[l]=null)},handleFileChange(l,e){const u=l.target.files[0];u&&["image/jpeg","image/png"].includes(u.type)?(this.dataForm[e]=u,e=="file1"?this.dataForm.noteFile1="KTP Pemohon":e=="file2"?this.dataForm.noteFile2="KTP Pasangan":e=="file3"?this.dataForm.noteFile3="KTP Atas Nama Jaminan":e=="file4"?this.dataForm.noteFile4="Kartu Keluarga":e=="file5"?this.dataForm.noteFile5="Buku Nikah":e=="file7"?this.dataForm.noteFile7="Jaminan SHM":e=="file8"?this.dataForm.noteFile8="Jaminan BPKB":e=="file9"?this.dataForm.noteFile9="Foto Detail Mesin":e=="file10"&&(this.dataForm.noteFile10="Foto Kunjungan")):(this.$showToast("error","Error","Hanya file JPG, JPEG, dan PNG yang diizinkan."),l.target.value=null)},async openModal(l,e=null){l===1?this.insert=!0:l===2&&console.log("masuk")},closeModal(l){l===1?(this.resetForm(),this.insert=!1):l===2&&(this.resetForm(),this.edit=!1)},resetForm(){this.dataForm={id:null,name:"",plafon:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}},formatInput(l){return l=l.replace(/\D/g,""),l=l.replace(/\B(?=(\d{3})+(?!\d))/g,","),l},filterDataStatus(l){this.items=this.originalItems.filter(e=>e.isApproved==l)},getUserData(){const l=localStorage.getItem("userData");l&&(this.userData=JSON.parse(l))},async getAllFiles(){try{const l=await b.get("/user/credit");l.status===200?(this.items=l.data.data.files,this.userAccess=l.data.data.userAccess,this.originalItems=[...this.items]):this.$showToast("error","Sorry",l.data.data.message)}catch(l){this.$showToast("error","Sorry",l.response.data.message)}},formatInputPlafon(l){let e=l.target.value;e=e.replace(/\D/g,""),e=e.replace(/\B(?=(\d{3})+(?!\d))/g,","),l.target.value=e},async insertData(){try{this.overlay=!0;const l=new FormData;l.append("name",this.dataForm.name),l.append("plafon",this.dataForm.plafon.replace(/\D/g,"")),l.append("type_bussiness",this.dataForm.type_bussiness),l.append("desc_bussiness",this.dataForm.desc_bussiness);for(let p=1;p<=10;p++){if(p===6)continue;let s="file"+p,r="noteFile"+p,y="hasFile"+p;this.dataForm.hasOwnProperty(y)&&this.dataForm[y]||this.dataForm[s]?this.dataForm[s]&&(l.append(s,this.dataForm[s]),l.append(r,this.dataForm[r])):this.dataForm[s]&&l.append(s,this.dataForm[s])}if(!this.dataForm.file7&&!this.dataForm.file8&&!this.dataForm.file9){this.overlay=!1,this.$showToast("success","Success","Wajib memasukkan salah satu jenis jaminan");return}l.append("_method","POST");const e={onUploadProgress:p=>{try{this.uploadProgress=Math.round(p.loaded*100/p.total)}catch(s){console.error("Error calculating progress:",s)}},headers:{"Content-Type":"multipart/form-data"}},u=await b.post("/user/credit",l,e);u.status===200?(this.overlay=!1,this.closeModal(1),this.getAllFiles(),this.uploadProgress=null,this.$showToast("success","Success",u.data.message)):(this.overlay=!1,this.uploadProgress=null,this.getAllFiles(),this.$showToast("error","Sorry",u.data.message))}catch(l){this.overlay=!1,this.uploadProgress=null,this.closeModal(1),this.getAllFiles(),this.$showToast("error","Sorry",l.response.data.message)}}},mounted(){this.getAllFiles(),this.getUserData()}},H=i("br",null,null,-1),W=i("span",{class:"font-weight-bold text-lg"},"Loading....",-1),Q=i("p",null,"Data Kosong",-1),X=i("p",null,"loading data .....",-1),Y={key:0},Z={key:1},$={key:2},ee={class:"operation-wrapper"},se=["onClick"],le=i("span",{style:{color:"red"}},"*",-1),ae=i("span",{class:"subtitle-1 text-center"},"Nama Pemohon: ",-1),te=i("span",{style:{color:"red"}},"*",-1),oe=i("span",{class:"subtitle-1 text-center"},"Jumlah Plafon: ",-1),ie=i("span",{style:{color:"red"}},"*",-1),re=i("span",{class:"subtitle-1 text-center"},"KTP Pemohon : ",-1),ne=i("span",{style:{color:"red"}},"*",-1),ue=i("span",{class:"subtitle-1 text-center"},"Kartu Keluarga : ",-1),de=i("span",{style:{color:"red"}},"*",-1),me=i("span",{class:"subtitle-1 text-center"},"Foto Kunjungan : ",-1),pe=i("span",{style:{color:"red"}},"*",-1),he=i("span",{class:"subtitle-1 text-center"},"KTP Pasangan Pemohon : ",-1),fe=i("span",{style:{color:"red"}},"*",-1),ce=i("span",{class:"subtitle-1 text-center"},"Buku Nikah : ",-1),Fe=i("span",{style:{color:"red"}},"*",-1),ge=i("span",{class:"subtitle-1 text-center"},"KTP atas nama Jaminan : ",-1),_e=i("span",{style:{color:"red"}},"*",-1),ye=i("span",{class:"subtitle-1 text-center"},"Jenis Usaha: ",-1),Ve=i("span",{style:{color:"red"}},"*",-1),be=i("span",{class:"subtitle-1 text-center"},"Deskripsi Usaha: ",-1),ke=i("span",{style:{color:"red"}},"*",-1),ve=i("span",{class:"subtitle-1 text-center"},"Lampirkan Salah Satu Jenis Jaminan : ",-1),Pe=i("span",{style:{color:"red"}},"*",-1),xe=i("span",{class:"subtitle-1 text-center"},"Jaminan SHM : ",-1);function Ce(l,e,u,p,s,r){const y=S("EasyDataTable");return m(),F(P,null,[a(q,{absolute:!0,modelValue:s.overlay,"onUpdate:modelValue":e[0]||(e[0]=t=>s.overlay=t),contained:"",persistent:"",class:"align-center justify-center"},{default:o(()=>[a(n,null,{default:o(()=>[a(A,{color:"primary",size:"32",indeterminate:""}),H,W]),_:1})]),_:1},8,["modelValue"]),a(D,null,{default:o(()=>[a(M,{class:"text-2xl font-weight-bold d-flex justify-left"},{default:o(()=>[h(" List Credit ")]),_:1}),a(K,{modelValue:s.tab,"onUpdate:modelValue":e[1]||(e[1]=t=>s.tab=t),class:"v-tabs-pill","bg-color":"secondary"},{default:o(()=>[a(V,{value:"0"},{default:o(()=>[h("Semua")]),_:1}),a(V,{value:"1"},{default:o(()=>[h("Approved")]),_:1}),a(V,{value:"2"},{default:o(()=>[h("Pending")]),_:1}),a(V,{value:"3"},{default:o(()=>[h("Rejected")]),_:1})]),_:1},8,["modelValue"]),a(N,null,{default:o(()=>[a(E,{modelValue:s.tab,"onUpdate:modelValue":e[4]||(e[4]=t=>s.tab=t)},{default:o(()=>[(m(!0),F(P,null,U(s.phases,t=>(m(),g(L,{value:t.value},{default:o(()=>[a(T,{class:"d-flex justify-end pa-3"},{default:o(()=>[s.userAccess&&parseInt(s.userAccess.canInsertData)?(m(),g(x,{key:0,color:"primary",size:"small",class:"my-3 mx-3",onClick:e[2]||(e[2]=d=>r.openModal(1))},{default:o(()=>[h(" Tambah Data ")]),_:1})):f("",!0),a(R),a(_,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:s.searchValue,"onUpdate:modelValue":e[3]||(e[3]=d=>s.searchValue=d)},null,8,["modelValue"])]),_:1}),a(y,{"show-index":"",headers:s.headers,items:s.items,"search-value":s.searchValue},{"empty-message":o(()=>[Q]),loading:o(()=>[X]),"item-plafon":o(d=>[h("Rp. "+I(r.formatInput(d.plafon))+",-",1)]),"item-isApproved":o(d=>[parseInt(d.isApproved)==1?(m(),F("span",Y," Approved")):f("",!0),parseInt(d.isApproved)==2?(m(),F("span",Z," Pending")):f("",!0),parseInt(d.isApproved)==3?(m(),F("span",$," Rejected")):f("",!0)]),"item-operation":o(d=>[i("div",ee,[i("button",null,[a(C,{size:"20",icon:"bx-file-find",color:"blue",onClick:w=>r.toDetail(d)},null,8,["onClick"])]),h(" Â  "),s.userData&&d.user_id==s.userData.id?(m(),F("button",{key:0,onClick:w=>r.deleteFile(d)},[a(C,{size:"20",icon:"bx-trash",color:"red"})],8,se)):f("",!0)])]),_:1},8,["headers","items","search-value"])]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(O,{modelValue:s.insert,"onUpdate:modelValue":e[24]||(e[24]=t=>s.insert=t),width:"auto",persistent:"",transition:"dialog-top-transition"},{default:o(()=>[a(D,null,{title:o(()=>[h(" Tambah Data ")]),text:o(()=>[a(z,{onSubmit:j(r.insertData,["prevent"])},{default:o(()=>[a(T,null,{default:o(()=>[a(n,{md:"12",cols:"12"},{default:o(()=>[le,ae,a(_,{class:"my-3",modelValue:s.dataForm.name,"onUpdate:modelValue":e[5]||(e[5]=t=>s.dataForm.name=t),autofocus:"",rules:[s.rules.required]},null,8,["modelValue","rules"])]),_:1}),a(n,{md:"12",cols:"12"},{default:o(()=>[te,oe,a(_,{class:"my-3",modelValue:s.dataForm.plafon,"onUpdate:modelValue":e[6]||(e[6]=t=>s.dataForm.plafon=t),type:"text",onInput:r.formatInputPlafon},null,8,["modelValue","onInput"])]),_:1}),a(n,{md:"12",cols:"12"},{default:o(()=>[ie,re,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[7]||(e[7]=t=>r.handleFileChange(t,"file1"))},null,8,["rules"])]),_:1}),a(n,{md:"12",cols:"12"},{default:o(()=>[ne,ue,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[8]||(e[8]=t=>r.handleFileChange(t,"file4"))},null,8,["rules"])]),_:1}),a(n,{md:"12",cols:"12"},{default:o(()=>[de,me,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[9]||(e[9]=t=>r.handleFileChange(t,"file10"))},null,8,["rules"])]),_:1}),a(k,{thickness:5}),a(n,{cols:"12",md:"12"},{default:o(()=>[a(v,{modelValue:s.dataForm.hasFile2,"onUpdate:modelValue":e[10]||(e[10]=t=>s.dataForm.hasFile2=t),label:"Apakah pemohon sudah menikah?",onChange:e[11]||(e[11]=t=>(r.resetFile("file2"),r.resetFile("file5")))},null,8,["modelValue"])]),_:1}),a(k,{thickness:5}),s.dataForm.hasFile2?(m(),g(n,{key:0,md:"12",cols:"12"},{default:o(()=>[pe,he,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[12]||(e[12]=t=>r.handleFileChange(t,"file2"))},null,8,["rules"])]),_:1})):f("",!0),s.dataForm.hasFile2?(m(),g(n,{key:1,md:"12",cols:"12"},{default:o(()=>[fe,ce,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[13]||(e[13]=t=>r.handleFileChange(t,"file5"))},null,8,["rules"])]),_:1})):f("",!0),a(n,{cols:"12",md:"12"},{default:o(()=>[a(v,{modelValue:s.dataForm.hasFile3,"onUpdate:modelValue":e[14]||(e[14]=t=>s.dataForm.hasFile3=t),label:"Apakah agunan bukan atas nama pemohon?",onChange:e[15]||(e[15]=t=>r.resetFile("file3"))},null,8,["modelValue"])]),_:1}),s.dataForm.hasFile3?(m(),g(n,{key:2,md:"12",cols:"12"},{default:o(()=>[Fe,ge,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[16]||(e[16]=t=>r.handleFileChange(t,"file3"))},null,8,["rules"])]),_:1})):f("",!0),a(k,{thickness:5}),a(n,{md:"12",cols:"12"},{default:o(()=>[_e,ye,a(_,{class:"my-3",modelValue:s.dataForm.type_bussiness,"onUpdate:modelValue":e[17]||(e[17]=t=>s.dataForm.type_bussiness=t),rules:[s.rules.required]},null,8,["modelValue","rules"])]),_:1}),a(n,{md:"12",cols:"12"},{default:o(()=>[Ve,be,a(_,{class:"my-3",modelValue:s.dataForm.desc_bussiness,"onUpdate:modelValue":e[18]||(e[18]=t=>s.dataForm.desc_bussiness=t),rules:[s.rules.required]},null,8,["modelValue","rules"])]),_:1}),a(n,null,{default:o(()=>[ke,ve]),_:1}),a(n,{cols:"12",md:"12"},{default:o(()=>[a(v,{modelValue:s.dataForm.hasFile7,"onUpdate:modelValue":e[19]||(e[19]=t=>s.dataForm.hasFile7=t),label:"Jenis Jaminan SHM ?",onChange:e[20]||(e[20]=t=>r.resetFile("file7"))},null,8,["modelValue"])]),_:1}),s.dataForm.hasFile7?(m(),g(n,{key:3,md:"12",cols:"12"},{default:o(()=>[Pe,xe,a(c,{class:"my-3",accept:"image/jpeg,image/png",placeholder:"Pick an image",rules:[s.rules.required],onChange:e[21]||(e[21]=t=>r.handleFileChange(t,"file7"))},null,8,["rules"])]),_:1})):f("",!0),a(n,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:o(()=>[a(x,{type:"submit",disabled:s.dataForm.hasFile2&&(s.dataForm.file2==null||s.dataForm.file5==null)||s.dataForm.hasFile3&&s.dataForm.file3==null||s.dataForm.hasFile7&&s.dataForm.file7==null||s.dataForm.hasFile8&&s.dataForm.file8==null||s.dataForm.hasFile9&&s.dataForm.file9==null||s.dataForm.file7==null&&s.dataForm.file8==null&&s.dataForm.file9==null||s.dataForm.type_bussiness==null&&s.dataForm.desc_bussiness==null},{default:o(()=>[h(" Simpan ")]),_:1},8,["disabled"]),i("button",{type:"button",class:"btn btn-blue",onClick:e[22]||(e[22]=t=>r.closeModal(1))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),actions:o(()=>[a(J,{modelValue:s.uploadProgress,"onUpdate:modelValue":e[23]||(e[23]=t=>s.uploadProgress=t),color:"amber",height:"25"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}const Re=B(G,[["render",Ce]]);export{Re as default};
