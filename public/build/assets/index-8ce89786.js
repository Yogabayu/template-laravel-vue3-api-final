import{m as b}from"./axios-379d51f3.js";import{I as O}from"./insertKredit-9f088b1b.js";import{_ as N,r as k,o as u,i as h,w as a,a as l,f as n,c as _,G as F,e as C,j as A,h as f,b as d,t as y,L as g,M as I,O as D,d as w,H as L,I as P,J as K}from"./main-6df84664.js";import{V as B,c as M,b as U}from"./VCard-59111084.js";import{V as T}from"./VSpacer-cdf28e6e.js";import{a as m,V as j}from"./VTabs-1c7a6e78.js";import{V as G,a as W}from"./VWindowItem-d772553a.js";import{V as z}from"./VRow-7c89dc54.js";import{V as H}from"./VTextField-0103a441.js";import{V as S}from"./VTooltip-d5114786.js";import"./VDialog-c148ae8f.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-1f485cfd.js";import"./VForm-ac2e92e8.js";import"./VInput-dc4af849.js";import"./index-0b1f53bb.js";import"./VSelect-95c14991.js";import"./VMenu-548a0d99.js";import"./VAvatar-1e01c729.js";import"./VImg-7dff9647.js";import"./VChip-a884aee0.js";import"./VFileInput-556aed07.js";import"./VCheckbox-b578d38d.js";const q={inject:["loading"],components:{InsertModal:O},computed:{searchableItems(){return this.items.map(e=>({...e,office_names:e.user.position.offices.map(t=>t.name).join(", ")}))}},data(){return{selectedOption:"bukuNikah",selectedPhoto:"",overlay:!1,insert:!1,searchValue:"",userData:null,userToken:null,uploadProgress:null,tab:0,rules:{required:e=>!!e||"Required"},role:{canDownload:0},items:[],originalItems:[],userAccess:null,headers:[{text:"Nama",value:"name",sortable:!0},{text:"Plafon",value:"plafon",sortable:!0},{text:"Tipe",value:"type",sortable:!0},{text:"Status",value:"isApproved",sortable:!0},{text:"AO/RO",value:"aoro",sortable:!0},{text:"Kantor",value:"office_names",sortable:!0},{text:"Tanggal",value:"created_at",sortable:!0},{text:"SLIK",value:"slik",sortable:!1},{text:"Analisa AO/RO",value:"analisaAO",sortable:!1},{text:"Aksi",value:"operation",width:100}],phases:[{value:0},{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7},{value:8}],searchField:["name","plafon","phase","type_bussiness","desc_bussiness","reasonRejected","nik_pemohon","nik_pasangan","nik_jaminan","address","no_hp","order_source","status_kredit","user.name","user.position.name","office_names"],orderList:[{value:"AO SENDIRI",title:"AO SENDIRI"},{value:"C. SERVIS / KANTOR",title:"C. SERVIS / KANTOR"},{value:"NASABAH",title:"NASABAH"},{value:"CROSS SALING DIVISI",title:"CROSS SALING DIVISI"},{value:"AGEN MGM / LAINNYA",title:"AGEN MGM / LAINNYA"},{value:"WEBSITE / WA / SOSMED",title:"WEBSITE / WA/ SOSMED"},{value:"TEAM BUSSINES",title:"TEAM BUSSINES"},{value:"PROGRAM KKB NEW",title:"PROGRAM KKB NEW"},{value:"PROGRAM KKB SECOND",title:"PROGRAM KKB SECOND"},{value:"CENTRO",title:"CENTRO"}],statusCreditList:[{value:"FRESH",title:"FRESH"},{value:"REPEAT ORDER",title:"REPEAT ORDER"},{value:"TOPUP",title:"TOPUP"}],isStatusPhase:!1,statusPhase:0,totalPlafon:"0"}},watch:{tab(e){e==1?this.filterDataStatus(1):e==2?this.filterDataStatus(2):e==3?this.filterDataStatus(3):e==4?this.filterDataStatus(4):e==5?this.filterDataStatus(5):e==6?this.filterDataStatus(6):e==7?this.filterDataStatus(7):e==8?this.filterDataStatus(8):this.items=[...this.originalItems]}},methods:{filterDataStatus(e){const t={1:s=>s.isApproved==1,2:s=>s.isApproved==2,3:s=>s.isApproved==3,4:s=>parseInt(s.phase)==1,8:s=>parseInt(s.phase)==5,5:s=>s.attachments.some(r=>r.name.includes("SLIK")&&parseInt(r.phase)==2&&(r.path!="null"||r.link!=null)),6:s=>parseInt(s.phase)==4,7:s=>s.isApproved==4};this.items=e in t?this.originalItems.filter(t[e]):[...this.originalItems]},hasSlikAttachment(e){return e.some(t=>t.name.includes("SLIK")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},hasAnalisaAoAttachment(e){return e.some(t=>t.name.includes("Analisa Awal Kredit AO")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},customSearch(e,t,s){return t?e.filter(r=>s.some(o=>o==="user.position.offices.name"?r.user.position.offices.some(c=>c.name.toLowerCase().includes(t.toLowerCase())):String(this.getNestedValue(r,o)).toLowerCase().includes(t.toLowerCase()))):e},getNestedValue(e,t){return t.split(".").reduce((s,r)=>s&&s[r]!==void 0?s[r]:null,e)},async toPage(){this.loading.show(),await this.$nextTick(),this.$router.push("/u-indexfilter")},formatDate(e){return new Date(e).toLocaleString("id-ID")},async downloadFile(e){try{this.loading.show();const t=await b.get(`/download-all/${e}`,{responseType:"blob"});if(t.status===200){this.loading.hide();const s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",`${e}.zip`),document.body.appendChild(r),r.click(),document.body.removeChild(r),this.$showToast("success","Berhasil","File berhasil diunduh")}else this.loading.hide(),this.$showToast("error","Error","Gagal mengunduh file")}catch{this.loading.hide(),this.$showToast("error","Error","Terjadi kesalahan saat mengunduh file")}},formatInput(e){return e=e.replace(/\D/g,""),e=e.replace(/\B(?=(\d{3})+(?!\d))/g,","),e},toDetail(e){this.$router.push(`/u-credit/${e.id}`)},async deleteFile(e){try{if(this.loading.show(),!window.confirm("Apakah Anda yakin ingin menghapus data? Semua Data akan terhapus secara permanen."))return;const s=await b.delete(`/user/credit/${e.id}`);s.status===200?(this.loading.hide(),this.getAllFiles(),this.$showToast("success","Berhasill",s.data.message)):(this.loading.hide(),this.getAllFiles(),this.$showToast("error","Sorry",s.data.message))}catch(t){this.loading.hide(),this.getAllFiles(),this.$showToast("error","Sorry",t.response.data.message)}},resetFile(e){!this.dataForm[e]!=null&&(this.dataForm[e]=null)},async openModal(e,t=null){e===1&&(this.insert=!0)},closeModal(e){e===1?(this.resetForm(),this.insert=!1):e===2&&(this.resetForm(),this.edit=!1)},resetForm(){this.dataForm={id:null,name:"",plafon:null,order_source:null,status_kredit:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}},getUserData(){const e=localStorage.getItem("userData");e&&(this.userData=JSON.parse(e))},async getAllFiles(){try{const e=await b.get("/user/credit");e.status===200?(this.items=e.data.data.files,this.userAccess=e.data.data.userAccess,this.role=e.data.data.role,this.originalItems=[...this.items]):this.$showToast("error","Sorry",e.data.data.message)}catch(e){this.$showToast("error","Sorry",e.response.data.message)}}},async mounted(){try{this.loading.show(),await Promise.all([this.getAllFiles(),this.getUserData()])}catch(e){console.error("Error in mounted:",e)}finally{this.loading.hide()}}};const R=e=>(P("data-v-fcbf86b1"),e=e(),K(),e),J=R(()=>d("p",null,"Data Kosong",-1)),Y=R(()=>d("p",null,"loading data .....",-1)),Q={key:0},X={key:1},Z={key:2},$={key:3},ee={key:0},te={key:1},ae={class:"operation-wrapper"},se={class:"d-flex justify-space-between"},le=["onClick"],ie=["onClick"];function oe(e,t,s,r,o,c){const V=k("EasyDataTable"),x=k("InsertModal");return u(),h(B,null,{default:a(()=>[l(M,{class:"text-2xl font-weight-bold d-flex justify-left"},{default:a(()=>[n(" List Kredit Bulan ini "),l(T)]),_:1}),l(j,{modelValue:o.tab,"onUpdate:modelValue":t[0]||(t[0]=v=>o.tab=v),class:"v-tabs-pill","bg-color":"secondary"},{default:a(()=>[l(m,{value:"0"},{default:a(()=>[n("Semua")]),_:1}),l(m,{value:"1"},{default:a(()=>[n("Approved")]),_:1}),l(m,{value:"2"},{default:a(()=>[n("Pending")]),_:1}),l(m,{value:"3"},{default:a(()=>[n("Rejected")]),_:1}),l(m,{value:"7"},{default:a(()=>[n("Cancel")]),_:1}),n(" | "),l(m,{value:"4"},{default:a(()=>[n("Pooling")]),_:1}),l(m,{value:"5"},{default:a(()=>[n("SLIK")]),_:1}),l(m,{value:"6"},{default:a(()=>[n("Komite")]),_:1}),l(m,{value:"8"},{default:a(()=>[n("OPS")]),_:1})]),_:1},8,["modelValue"]),l(U,null,{default:a(()=>[l(G,{modelValue:o.tab,"onUpdate:modelValue":t[5]||(t[5]=v=>o.tab=v)},{default:a(()=>[(u(!0),_(L,null,F(o.phases,v=>(u(),h(W,{value:v.value},{default:a(()=>[l(z,{class:"d-flex justify-end pa-3 mb-1"},{default:a(()=>[o.userAccess&&parseInt(o.userAccess.canInsertData)?(u(),h(C,{key:0,color:"primary",size:"small",class:"my-3 mx-3",onClick:t[1]||(t[1]=i=>c.openModal(1))},{default:a(()=>[l(A,{icon:"mdi-plus"}),n("Tambah Data ")]),_:1})):f("",!0),l(T),l(H,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:o.searchValue,"onUpdate:modelValue":t[2]||(t[2]=i=>o.searchValue=i)},null,8,["modelValue"])]),_:1}),d("div",{class:"table-container",onTouchstart:t[3]||(t[3]=w(()=>{},["stop"])),onTouchmove:t[4]||(t[4]=w(()=>{},["stop"]))},[l(V,{"show-index":"",headers:o.headers,items:c.searchableItems,"search-value":o.searchValue,"search-field":o.searchField,"border-cell":"","buttons-pagination":"","rows-per-page":500},{"empty-message":a(()=>[J]),loading:a(()=>[Y]),"item-plafon":a(i=>[n("Rp. "+y(c.formatInput(i.plafon))+",-",1)]),"item-isApproved":a(i=>[parseInt(i.isApproved)==1?(u(),_("span",Q," Approved")):f("",!0),parseInt(i.isApproved)==2?(u(),_("span",X," Pending")):f("",!0),parseInt(i.isApproved)==3?(u(),_("span",Z," Rejected")):f("",!0),parseInt(i.isApproved)==4?(u(),_("span",$," Cancel by Debitur")):f("",!0)]),"item-type":a(i=>[parseInt(i.type)===1?(u(),_("span",ee," Reguler")):f("",!0),parseInt(i.type)===2?(u(),_("span",te," Restruktur")):f("",!0)]),"item-aoro":a(i=>[d("span",null,y(i.user.name),1)]),"item-created_at":a(i=>[d("span",null,y(c.formatDate(i.created_at))+" WIB",1)]),"item-slik":a(i=>[c.hasSlikAttachment(i.attachments)?(u(),h(S,{key:0,location:"top",text:"Kondisi SLIK Sudah Terupload"},{activator:a(({props:p})=>[d("span",g(I(p)),[l(A,{color:"success"},{default:a(()=>[n("mdi-check-circle")]),_:1})],16)]),_:1})):(u(),h(S,{key:1,location:"top",text:"Kondisi SLIK Belum Terupload"},{activator:a(({props:p})=>[d("span",g(I(p)),[l(A,{color:"error"},{default:a(()=>[n("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-analisaAO":a(i=>[c.hasAnalisaAoAttachment(i.attachments)?(u(),h(S,{key:0,location:"top",text:"Analisa AO Sudah Terupload"},{activator:a(({props:p})=>[d("span",g(I(p)),[l(A,{color:"success"},{default:a(()=>[n("mdi-check-circle")]),_:1})],16)]),_:1})):(u(),h(S,{key:1,location:"top",text:"Analisa AO Belum Terupload"},{activator:a(({props:p})=>[d("span",g(I(p)),[l(A,{color:"error"},{default:a(()=>[n("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-operation":a(i=>[d("div",ae,[d("div",se,[l(S,{location:"top",text:"Detail Kredit"},{activator:a(({props:p})=>[d("button",D(p,{onClick:E=>c.toDetail(i)}),[l(A,{size:"20",icon:"bx-link-external",color:"blue"})],16,le)]),_:2},1024),o.role&&o.role.canDownload==1?(u(),h(S,{key:0,location:"top",text:"Download Semua File Kredit"},{activator:a(({props:p})=>[d("button",D(p,{onClick:E=>c.downloadFile(i.id)}),[l(A,{size:"20",icon:"bx-download",color:"red"})],16,ie)]),_:2},1024)):f("",!0)])])]),_:1},8,["headers","items","search-value","search-field"])],32)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),l(x,{modelValue:o.insert,"onUpdate:modelValue":t[6]||(t[6]=v=>o.insert=v),"order-list":o.orderList,"status-credit-list":o.statusCreditList,"close-modal":c.closeModal,"get-all-files":c.getAllFiles},null,8,["modelValue","order-list","status-credit-list","close-modal","get-all-files"])]),_:1})}const xe=N(q,[["render",oe],["__scopeId","data-v-fcbf86b1"]]);export{xe as default};
