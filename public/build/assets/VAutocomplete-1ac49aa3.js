import{m as we,u as Se,a as Ce}from"./VSelect-66ce21e0.js";import{m as be,a as le}from"./VTextField-008cf622.js";import{N as oe,n as L,k as A,u as N,O as xe,P as J,Q as pe,R as Ie,S as Me,T as Ae,U,W as Y,X as Pe,y as Z,A as te,Y as _e,Z as Ke,a as c,G as Q,M as H,i as ae,_ as Re,$ as De,e as Le,a0 as Te,a1 as ue}from"./main-01045026.js";import{u as Oe}from"./VInput-d24837f2.js";import{f as Ee}from"./index-67561c07.js";import{u as Ne,V as Ue,a as je,b as ne}from"./VMenu-6c6fc507.js";import{m as Be}from"./VImg-c0f76b99.js";import{V as $e}from"./VCheckboxBtn-56ae44fc.js";import{V as ze}from"./VChip-54d46267.js";const He=(e,s,l)=>e==null||s==null?-1:e.toString().toLocaleLowerCase().indexOf(s.toString().toLocaleLowerCase()),Qe=oe({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function We(e,s,l){var C;const m=[],v=(l==null?void 0:l.default)??He,g=l!=null&&l.filterKeys?J(l.filterKeys):!1,F=Object.keys((l==null?void 0:l.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return m;e:for(let d=0;d<e.length;d++){const[w,b=w]=J(e[d]),r={},a={};let y=-1;if(s&&!(l!=null&&l.noFilter)){if(typeof w=="object"){const T=g||Object.keys(b);for(const p of T){const j=pe(b,p,b),O=(C=l==null?void 0:l.customKeyFilter)==null?void 0:C[p];if(y=O?O(j,s,w):v(j,s,w),y!==-1&&y!==!1)O?r[p]=y:a[p]=y;else if((l==null?void 0:l.filterMode)==="every")continue e}}else y=v(w,s,w),y!==-1&&y!==!1&&(a.title=y);const M=Object.keys(a).length,x=Object.keys(r).length;if(!M&&!x||(l==null?void 0:l.filterMode)==="union"&&x!==F&&!M||(l==null?void 0:l.filterMode)==="intersection"&&(x!==F||!M))continue}m.push({index:d,matches:{...a,...r}})}return m}function Ge(e,s,l,m){const v=L([]),g=L(new Map),F=A(()=>m!=null&&m.transform?N(s).map(d=>[d,m.transform(d)]):N(s));xe(()=>{const d=typeof l=="function"?l():N(l),w=typeof d!="string"&&typeof d!="number"?"":String(d),b=We(F.value,w,{customKeyFilter:{...e.customKeyFilter,...N(m==null?void 0:m.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),r=N(s),a=[],y=new Map;b.forEach(M=>{let{index:x,matches:T}=M;const p=r[x];a.push(p),y.set(p.value,T)}),v.value=a,g.value=y});function C(d){return g.value.get(d.value)}return{filteredItems:v,filteredMatches:g,getMatches:C}}function Xe(e,s,l){if(s==null)return e;if(Array.isArray(s))throw new Error("Multiple matches is not implemented");return typeof s=="number"&&~s?c(Q,null,[c("span",{class:"v-autocomplete__unmask"},[e.substr(0,s)]),c("span",{class:"v-autocomplete__mask"},[e.substr(s,l)]),c("span",{class:"v-autocomplete__unmask"},[e.substr(s+l)])]):e}const Ye=oe({autoSelectFirst:{type:[Boolean,String]},search:String,...Qe({filterKeys:["title"]}),...we(),...Ie(be({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Be({transition:!1})},"VAutocomplete"),ol=Me()({name:"VAutocomplete",props:Ye(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,s){let{slots:l}=s;const{t:m}=Ae(),v=L(),g=U(!1),F=U(!0),C=U(!1),d=L(),w=L(),b=Y(e,"menu"),r=A({get:()=>b.value,set:t=>{var u;b.value&&!t&&((u=d.value)!=null&&u.Î¨openChildren)||(b.value=t)}}),a=U(-1),y=A(()=>{var t;return(t=v.value)==null?void 0:t.color}),M=A(()=>r.value?e.closeText:e.openText),{items:x,transformIn:T,transformOut:p}=Ne(e),{textColorClasses:j,textColorStyles:O}=Pe(y),h=Y(e,"search",""),o=Y(e,"modelValue",[],t=>T(t===null?[null]:J(t)),t=>{const u=p(t);return e.multiple?u:u[0]??null}),R=Oe(),{filteredItems:W,getMatches:re}=Ge(e,x,()=>F.value?"":h.value),I=A(()=>e.hideSelected?W.value.filter(t=>!o.value.some(u=>u.value===t.value)):W.value),se=A(()=>o.value.map(t=>t.props.value)),B=A(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&h.value===((u=I.value[0])==null?void 0:u.title))&&I.value.length>0&&!F.value&&!C.value}),G=A(()=>e.hideNoData&&!x.value.length||e.readonly||(R==null?void 0:R.isReadonly.value)),X=L(),{onListScroll:ce,onListKeydown:ie}=Se(X,v);function fe(t){e.openOnClear&&(r.value=!0),h.value=""}function ve(){G.value||(r.value=!0)}function de(t){G.value||(g.value&&(t.preventDefault(),t.stopPropagation()),r.value=!r.value)}function me(t){var D,n,V;if(e.readonly||R!=null&&R.isReadonly.value)return;const u=v.value.selectionStart,i=o.value.length;if((a.value>-1||["Enter","ArrowDown","ArrowUp"].includes(t.key))&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(r.value=!0),["Escape"].includes(t.key)&&(r.value=!1),B.value&&["Enter","Tab"].includes(t.key)&&P(I.value[0]),t.key==="ArrowDown"&&B.value&&((D=X.value)==null||D.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(t.key)){if(a.value<0){t.key==="Backspace"&&!h.value&&(a.value=i-1);return}const f=a.value,S=o.value[a.value];S&&!S.props.disabled&&P(S),a.value=f>=i-1?i-2:f}if(t.key==="ArrowLeft"){if(a.value<0&&u>0)return;const f=a.value>-1?a.value-1:i-1;o.value[f]?a.value=f:(a.value=-1,v.value.setSelectionRange((n=h.value)==null?void 0:n.length,(V=h.value)==null?void 0:V.length))}if(t.key==="ArrowRight"){if(a.value<0)return;const f=a.value+1;o.value[f]?a.value=f:(a.value=-1,v.value.setSelectionRange(0,0))}}}function he(t){h.value=t.target.value}function ge(t){if(ue(v.value,":autofill")||ue(v.value,":-webkit-autofill")){const u=x.value.find(i=>i.title===t.target.value);u&&P(u)}}function ye(){var t;g.value&&(F.value=!0,(t=v.value)==null||t.focus())}function Ve(t){g.value=!0,setTimeout(()=>{C.value=!0})}function Fe(t){C.value=!1}function ke(t){(t==null||t===""&&!e.multiple)&&(o.value=[])}const E=U(!1);function P(t){if(e.multiple){const u=o.value.findIndex(i=>e.valueComparator(i.value,t.value));if(u===-1)o.value=[...o.value,t];else{const i=[...o.value];i.splice(u,1),o.value=i}}else o.value=[t],E.value=!0,h.value=t.title,r.value=!1,F.value=!0,te(()=>E.value=!1)}return Z(g,(t,u)=>{var i;t!==u&&(t?(E.value=!0,h.value=e.multiple?"":String(((i=o.value.at(-1))==null?void 0:i.props.title)??""),F.value=!0,te(()=>E.value=!1)):(!e.multiple&&!h.value?o.value=[]:B.value&&!C.value&&!o.value.some(D=>{let{value:n}=D;return n===I.value[0].value})&&P(I.value[0]),r.value=!1,h.value="",a.value=-1))}),Z(h,t=>{!g.value||E.value||(t&&(r.value=!0),F.value=!t)}),Z(r,()=>{if(!e.hideSelected&&r.value&&o.value.length){const t=I.value.findIndex(u=>o.value.some(i=>u.value===i.value));_e&&window.requestAnimationFrame(()=>{var u;t>=0&&((u=w.value)==null||u.scrollToIndex(t))})}}),Ke(()=>{const t=!!(e.chips||l.chip),u=!!(!e.hideNoData||I.value.length||l["prepend-item"]||l["append-item"]||l["no-data"]),i=o.value.length>0,D=le.filterProps(e);return c(le,H({ref:v},D,{modelValue:h.value,"onUpdate:modelValue":ke,focused:g.value,"onUpdate:focused":n=>g.value=n,validationValue:o.externalValue,counterValue:o.value.length,dirty:i,onInput:he,onChange:ge,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!l.selection,"v-autocomplete--selecting-index":a.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:i?void 0:e.placeholder,"onClick:clear":fe,"onMousedown:control":ve,onKeydown:me}),{...l,default:()=>c(Q,null,[c(Ue,H({ref:d,modelValue:r.value,"onUpdate:modelValue":n=>r.value=n,activator:"parent",contentClass:"v-autocomplete__content",disabled:G.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ye},e.menuProps),{default:()=>[u&&c(je,{ref:X,selected:se.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:ie,onFocusin:Ve,onFocusout:Fe,onScrollPassive:ce,tabindex:"-1",color:e.itemColor??e.color},{default:()=>{var n,V,f;return[(n=l["prepend-item"])==null?void 0:n.call(l),!I.value.length&&!e.hideNoData&&(((V=l["no-data"])==null?void 0:V.call(l))??c(ne,{title:m(e.noDataText)},null)),c(Ce,{ref:w,renderless:!0,items:I.value},{default:S=>{var ee;let{item:k,index:_,itemRef:K}=S;const q=H(k.props,{ref:K,key:_,active:B.value&&_===0?!0:void 0,onClick:()=>P(k)});return((ee=l.item)==null?void 0:ee.call(l,{item:k,index:_,props:q}))??c(ne,q,{prepend:$=>{let{isSelected:z}=$;return c(Q,null,[e.multiple&&!e.hideSelected?c($e,{key:k.value,modelValue:z,ripple:!1,tabindex:"-1"},null):void 0,k.props.prependIcon&&c(ae,{icon:k.props.prependIcon},null)])},title:()=>{var $,z;return F.value?k.title:Xe(k.title,($=re(k))==null?void 0:$.title,((z=h.value)==null?void 0:z.length)??0)}})}}),(f=l["append-item"])==null?void 0:f.call(l)]}})]}),o.value.map((n,V)=>{function f(K){K.stopPropagation(),K.preventDefault(),P(n)}const S={"onClick:close":f,onMousedown(K){K.preventDefault(),K.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},k=t?!!l.chip:!!l.selection,_=k?Re(t?l.chip({item:n,index:V,props:S}):l.selection({item:n,index:V})):void 0;if(!(k&&!_))return c("div",{key:n.value,class:["v-autocomplete__selection",V===a.value&&["v-autocomplete__selection--selected",j.value]],style:V===a.value?O.value:{}},[t?l.chip?c(De,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[_]}):c(ze,H({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},S),null):_??c("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&V<o.value.length-1&&c("span",{class:"v-autocomplete__selection-comma"},[Le(",")])])])})]),"append-inner":function(){var S;for(var n=arguments.length,V=new Array(n),f=0;f<n;f++)V[f]=arguments[f];return c(Q,null,[(S=l["append-inner"])==null?void 0:S.call(l,...V),e.menuIcon?c(ae,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:de,onClick:Te,"aria-label":m(M.value),title:m(M.value)},null):void 0])}})}),Ee({isFocused:g,isPristine:F,menu:r,search:h,filteredItems:W,select:P},v)}});export{ol as V};
