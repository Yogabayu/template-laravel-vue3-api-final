import{m as v}from"./axios-379d51f3.js";import{I as N}from"./insertKredit-14942476.js";import{_ as B,r as V,o as p,i as _,w as a,a as s,f as n,V as y,e as w,b as h,j as m,c as g,G as K,h as k,t as T,L as b,M as A,O as P,d as R,H as L,I as U,J as j}from"./main-2e92db68.js";import{V as G}from"./VContainer-642e8748.js";import{a as W,c as z,b as O,V as x}from"./VCard-977801d5.js";import{V as D}from"./VRow-169bf206.js";import{V as E}from"./VTextField-5f955275.js";import{V as H}from"./VSelect-f02185f0.js";import{V as J,a as f}from"./VTabs-1b0f8ab0.js";import{V as Y,a as q}from"./VWindowItem-24052977.js";import{V as $}from"./VSpacer-75d256d3.js";import{V as S}from"./VTooltip-d5173e86.js";import"./VDialog-bd3a13f6.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-f7fd435d.js";import"./VForm-1cb7dab5.js";import"./VInput-c3a74e03.js";import"./index-307703ac.js";import"./VFileInput-bffb8fe9.js";import"./VChip-0c7dc406.js";import"./VAvatar-00a62029.js";import"./VImg-81ba3ef7.js";import"./VCheckbox-911c776f.js";import"./VMenu-afc7cd0f.js";const Q={inject:["loading"],components:{InsertModal:N},computed:{formattedPlafon:{get(){return this.formatNumber(this.dataForm.plafon)},set(e){this.dataForm.plafon=e.replace(/\D/g,"")}},formattedMaxPlafon:{get(){return this.formatNumber(this.dataForm.plafon)},set(e){this.dataForm.plafon=e.replace(/\D/g,"")}},searchableItems(){return this.items.map(e=>({...e,office_names:e.user.position.offices.map(t=>t.name).join(", ")}))}},data(){return{selectedMonth:new Date().toISOString().slice(0,7),selectedOffice:null,offices:[],monthYear:this.$route.params.monthYear,selectedOption:"bukuNikah",selectedPhoto:"",insert:!1,searchValue:"",userData:null,userToken:null,uploadProgress:null,tab:0,rules:{required:e=>!!e||"Required"},role:{canDownload:0},items:[],originalItems:[],userAccess:null,headers:[{text:"Nama",value:"name",sortable:!0},{text:"Plafon",value:"plafon",sortable:!0},{text:"Tipe",value:"type",sortable:!0},{text:"Status",value:"isApproved",sortable:!0},{text:"AO/RO",value:"aoro",sortable:!0},{text:"Kantor",value:"office_names",sortable:!0},{text:"Tanggal",value:"created_at",sortable:!0},{text:"SLIK",value:"slik",sortable:!1},{text:"Analisa AO/RO",value:"analisaAO",sortable:!1},{text:"Aksi",value:"operation",width:100}],phases:[{value:0},{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7},{value:8}],orderList:[{value:"AO SENDIRI",title:"AO SENDIRI"},{value:"C. SERVIS / KANTOR",title:"C. SERVIS / KANTOR"},{value:"NASABAH",title:"NASABAH"},{value:"CROSS SALING DIVISI",title:"CROSS SALING DIVISI"},{value:"AGEN MGM / LAINNYA",title:"AGEN MGM / LAINNYA"},{value:"WEBSITE / WA / SOSMED",title:"WEBSITE / WA/ SOSMED"},{value:"TEAM BUSSINES",title:"TEAM BUSSINES"},{value:"PROGRAM KKB NEW",title:"PROGRAM KKB NEW"},{value:"PROGRAM KKB SECOND",title:"PROGRAM KKB SECOND"},{value:"CENTRO",title:"CENTRO"}],statusCreditList:[{value:"FRESH",title:"FRESH"},{value:"REPEAT ORDER",title:"REPEAT ORDER"},{value:"TOPUP",title:"TOPUP"}],searchField:["name","plafon","phase","type_bussiness","desc_bussiness","reasonRejected","nik_pemohon","nik_pasangan","nik_jaminan","address","no_hp","order_source","status_kredit","user.name","user.position.name","office_names"],dataForm:{id:null,name:"",plafon:null,type_bussiness:null,desc_bussiness:null,nik_pemohon:null,nik_pasangan:null,nik_jaminan:null,address:null,no_hp:null,order_source:null,status_kredit:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null,hasFile11:!1,file11:null},isStatusPhase:!1,statusPhase:0}},watch:{tab(e){e==1?this.filterDataStatus(1):e==2?this.filterDataStatus(2):e==3?this.filterDataStatus(3):e==4?this.filterDataStatus(4):e==5?this.filterDataStatus(5):e==6?this.filterDataStatus(6):e==7?this.filterDataStatus(7):e==8?this.filterDataStatus(8):this.items=[...this.originalItems]}},methods:{hasSlikAttachment(e){return e.some(t=>t.name.includes("SLIK")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},hasAnalisaAoAttachment(e){return e.some(t=>t.name.includes("Analisa Awal Kredit AO")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},goBack(){this.$router.go(-1)},async applyFilter(){try{if(this.selectedOffice==null){this.$showToast("warning","Sorry","Pilih kantor terlebih dahulu");return}this.loading.show();const[e,t]=this.selectedMonth.split("-"),l=new FormData;l.append("year",e),l.append("month",t),l.append("office_id",this.selectedOffice);const o=await v.post("/user/filterData",l);o.status===200?(this.items=o.data.data,this.originalItems=[...this.items],this.loading.hide(),this.tab=0):(this.loading.hide(),this.$showToast("error","Error","Terjadi kesalahan saat filter data"))}catch{this.loading.hide(),this.$showToast("error","Error","Terjadi kesalahan saat filter data")}},openMonthPicker(){this.$refs.monthPicker.$el.querySelector("input").click()},formatDate(e){return new Date(e).toLocaleString("id-ID")},async downloadFile(e){try{this.loading.show();const t=await v.get(`/download-all/${e}`,{responseType:"blob"});if(t.status===200){this.loading.hide();const l=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=l,o.setAttribute("download",`${e}.zip`),document.body.appendChild(o),o.click(),document.body.removeChild(o),this.$showToast("success","Berhasil","File berhasil diunduh")}else this.loading.hide(),this.$showToast("error","Error","Gagal mengunduh file")}catch{this.loading.hide(),this.$showToast("error","Error","Terjadi kesalahan saat mengunduh file")}},formatInput(e){return e=e.replace(/\D/g,""),e=e.replace(/\B(?=(\d{3})+(?!\d))/g,","),e},toDetail(e){this.$router.push(`/u-credit/${e.id}`)},async deleteFile(e){try{if(this.loading.show(),!window.confirm("Apakah Anda yakin ingin menghapus data? Semua Data akan terhapus secara permanen."))return;const l=await v.delete(`/user/credit/${e.id}`);l.status===200?(this.loading.hide(),this.applyFilter(),this.$showToast("success","Berhasill",l.data.message)):(this.loading.hide(),this.applyFilter(),this.$showToast("error","Sorry",l.data.message))}catch(t){this.loading.hide(),this.applyFilter(),this.$showToast("error","Sorry",t.response.data.message)}},resetFile(e){!this.dataForm[e]!=null&&(this.dataForm[e]=null)},handleFileChange(e,t){const l=e.target.files[0];l&&["image/jpeg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)?(this.dataForm[t]=l,t=="file1"?this.dataForm.noteFile1="KTP Pemohon":t=="file2"?this.dataForm.noteFile2="KTP Pasangan":t=="file3"?this.dataForm.noteFile3="KTP Atas Nama Jaminan":t=="file4"?this.dataForm.noteFile4="Kartu Keluarga":t=="file5"?this.dataForm.noteFile5="Buku Nikah":t=="file7"?this.dataForm.noteFile7="Jaminan SHM":t=="file8"?this.dataForm.noteFile8="Jaminan BPKB":t=="file9"?this.dataForm.noteFile9="Foto Detail Mesin":t=="file10"?this.dataForm.noteFile10="Foto Kunjungan":t=="file11"&&(this.dataForm.noteFile11="Foto WhatsApp")):(this.loading.hide(),this.$showToast("error","Error","Hanya file JPG, JPEG, PNG, dan PDF, WORD yang diizinkan."),e.target.value=null)},async getRecaptData(){try{if(this.loading.show(),this.selectedOffice==null){this.$showToast("error","Sorry","Pilih Kantor terlebih dahulu"),this.loading.hide();return}const[e,t]=this.selectedMonth.split("-"),l=new FormData;l.append("year",e),l.append("month",t),l.append("office_id",this.selectedOffice),l.append("type",this.tab);const o=await v.post("/user/filterDataReport",l,{responseType:"blob"});if(o.status===200){this.loading.hide();const i=o.headers["content-disposition"];let d="download.xlsx";if(i){const r=i.match(/filename="?(.+)"?/i);r.length===2&&(d=r[1])}const F=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),I=window.URL.createObjectURL(F),u=document.createElement("a");u.href=I,u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),this.$showToast("success","Berhasil","File Excel berhasil diunduh")}else this.$showToast("error","Sorry",o.data.data.message)}catch(e){this.loading.hide(),this.$showToast("error","Sorry",e.response.data.message)}},async openModal(e,t=null){e===1?this.insert=!0:e===2&&this.getRecaptData(this.selectedMonth)},closeModal(e){e===1?(this.resetForm(),this.insert=!1):e===2&&(this.resetForm(),this.edit=!1)},resetForm(){this.dataForm={id:null,name:"",plafon:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}},formatInputIn(e){let t=e.target.value;t=t.replace(/\D/g,""),t=t.replace(/\B(?=(\d{3})+(?!\d))/g,","),e.target.value=t},formatNumber(e){return e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):""},filterDataStatus(e){const t={1:l=>l.isApproved==1,2:l=>l.isApproved==2,3:l=>l.isApproved==3,4:l=>parseInt(l.phase)==1,8:l=>parseInt(l.phase)==5,5:l=>l.attachments.some(o=>o.name.includes("SLIK")&&parseInt(o.phase)==2&&(o.path!="null"||o.link!=null)),6:l=>parseInt(l.phase)==4,7:l=>l.isApproved==4};this.items=e in t?this.originalItems.filter(t[e]):[...this.originalItems]},getUserData(){const e=localStorage.getItem("userData");if(e){this.userData=JSON.parse(e),this.offices=this.userData.position.offices.map(o=>({value:o.id,title:o.name}));const t="ao/ro";if(this.userData.position.name.toLowerCase().replace(/\s/g,"")!==t){const o={value:0,title:"Semua Kantor"};this.offices.unshift(o)}}},formatInputPlafon(e){let t=e.target.value;t=t.replace(/\D/g,""),t=t.replace(/\B(?=(\d{3})+(?!\d))/g,","),e.target.value=t},async insertData(){try{this.loading.show();const e=new FormData;e.append("name",this.dataForm.name),e.append("nik_pemohon",this.dataForm.nik_pemohon),e.append("address",this.dataForm.address),e.append("no_hp",this.dataForm.no_hp),e.append("order_source",this.dataForm.order_source),e.append("status_kredit",this.dataForm.status_kredit),e.append("plafon",this.dataForm.plafon.replace(/\D/g,"")),e.append("type_bussiness",this.dataForm.type_bussiness),e.append("desc_bussiness",this.dataForm.desc_bussiness),this.dataForm.file2!=null&&e.append("nik_pasangan",this.dataForm.nik_pasangan),this.dataForm.file3!=null&&e.append("nik_jaminan",this.dataForm.nik_jaminan);for(let o=1;o<=11;o++){if(o===6)continue;let i="file"+o,d="noteFile"+o,F="hasFile"+o;this.dataForm.hasOwnProperty(F)&&this.dataForm[F]||this.dataForm[i]?this.dataForm[i]&&(e.append(i,this.dataForm[i]),e.append(d,this.dataForm[d])):this.dataForm[i]&&e.append(i,this.dataForm[i])}e.append("_method","POST");const t={onUploadProgress:o=>{try{this.uploadProgress=Math.round(o.loaded*100/o.total)}catch(i){console.error("Error calculating progress:",i)}},headers:{"Content-Type":"multipart/form-data"}},l=await v.post("/user/credit",e,t);l.status===200?(this.loading.hide(),this.closeModal(1),this.applyFilter(),this.uploadProgress=null,this.$showToast("success","Success",l.data.message)):(this.loading.hide(),this.uploadProgress=null,this.applyFilter(),this.$showToast("error","Sorry",l.data.message))}catch(e){this.loading.hide(),this.uploadProgress=null,this.closeModal(1),this.applyFilter(),this.$showToast("error","Sorry",e.response.data.message)}},async getUserAccess(){try{const e=await v.get("/user/userAccess");e.status===200?this.userAccess=e.data.data:console.log(e.data.data.message)}catch(e){console.log(e)}}},mounted(){this.getUserData(),this.getUserAccess()}};const C=e=>(U("data-v-d3d12e51"),e=e(),j(),e),X={class:"text-body-2"},Z=C(()=>h("p",null,"Data Kosong",-1)),ee=C(()=>h("p",null,"loading data .....",-1)),te={key:0},ae={key:1},se={key:2},le={key:3},oe={key:0},ie={key:1},re={key:2},ne={class:"operation-wrapper"},de={class:"d-flex justify-space-between"},ue=["onClick"],pe=["onClick"];function he(e,t,l,o,i,d){const F=V("EasyDataTable"),I=V("InsertModal");return p(),_(G,{fluid:""},{default:a(()=>[s(x,{class:"mx-auto",elevation:"4"},{default:a(()=>[s(W,null,{default:a(()=>[s(z,{class:"text-h5 font-weight-bold mx-2"},{default:a(()=>[n(" Filter Bulan dan Kantor ")]),_:1})]),_:1}),s(O,null,{default:a(()=>[s(D,null,{default:a(()=>[s(y,{cols:"12",sm:"6"},{default:a(()=>[s(E,{modelValue:i.selectedMonth,"onUpdate:modelValue":t[0]||(t[0]=u=>i.selectedMonth=u),label:"Pilih Bulan dan Tahun","prepend-icon":"mdi-calendar",type:"month",outlined:"",dense:"",onClick:d.openMonthPicker,ref:"monthPicker"},null,8,["modelValue","onClick"])]),_:1}),s(y,{cols:"12",sm:"6"},{default:a(()=>[s(H,{modelValue:i.selectedOffice,"onUpdate:modelValue":t[1]||(t[1]=u=>i.selectedOffice=u),items:i.offices,label:"Pilih Kantor","prepend-icon":"mdi-office-building",outlined:"",dense:""},null,8,["modelValue","items"])]),_:1})]),_:1}),s(D,{class:"mt-4"},{default:a(()=>[s(y,{cols:"12",class:"text-center"},{default:a(()=>[s(w,{color:"primary",onClick:d.applyFilter,elevation:"2"},{default:a(()=>[n(" Terapkan Filter ")]),_:1},8,["onClick"])]),_:1})]),_:1}),s(D,{class:"mt-4"},{default:a(()=>[s(y,{cols:"12"},{default:a(()=>[h("p",X,[s(m,{small:"",left:""},{default:a(()=>[n("mdi-information")]),_:1}),n(" Pilih bulan, tahun, dan kantor untuk menampilkan data ")])]),_:1})]),_:1})]),_:1})]),_:1}),s(x,{class:"mt-3",elevation:"4"},{default:a(()=>[s(J,{modelValue:i.tab,"onUpdate:modelValue":t[2]||(t[2]=u=>i.tab=u),class:"v-tabs-pill","bg-color":"secondary"},{default:a(()=>[s(f,{value:"0"},{default:a(()=>[n("Semua")]),_:1}),s(f,{value:"1"},{default:a(()=>[n("Approved")]),_:1}),s(f,{value:"2"},{default:a(()=>[n("Pending")]),_:1}),s(f,{value:"3"},{default:a(()=>[n("Rejected")]),_:1}),s(f,{value:"7"},{default:a(()=>[n("Cancel by Debitur")]),_:1}),n(" | "),s(f,{value:"4"},{default:a(()=>[n("Pooling")]),_:1}),s(f,{value:"5"},{default:a(()=>[n("SLIK")]),_:1}),s(f,{value:"6"},{default:a(()=>[n("Komite")]),_:1}),s(f,{value:"8"},{default:a(()=>[n("Ops")]),_:1})]),_:1},8,["modelValue"]),s(O,null,{default:a(()=>[s(Y,{modelValue:i.tab,"onUpdate:modelValue":t[8]||(t[8]=u=>i.tab=u)},{default:a(()=>[(p(!0),g(L,null,K(i.phases,u=>(p(),_(q,{value:u.value},{default:a(()=>[s(D,{class:"d-flex justify-end pa-3"},{default:a(()=>[i.userAccess&&parseInt(i.userAccess.canInsertData)?(p(),_(w,{key:0,color:"primary",size:"small",class:"my-3 mx-3",onClick:t[3]||(t[3]=r=>d.openModal(1))},{default:a(()=>[s(m,{icon:"mdi-plus"}),n(" Tambah Data ")]),_:1})):k("",!0),s(w,{color:"primary",size:"small",class:"my-3 mx-3",onClick:t[4]||(t[4]=r=>d.openModal(2))},{default:a(()=>[s(m,{icon:"mdi-download"}),n(" Rekap Data ")]),_:1}),s($),s(E,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:i.searchValue,"onUpdate:modelValue":t[5]||(t[5]=r=>i.searchValue=r)},null,8,["modelValue"])]),_:1}),h("div",{class:"table-container",onTouchstart:t[6]||(t[6]=R(()=>{},["stop"])),onTouchmove:t[7]||(t[7]=R(()=>{},["stop"]))},[s(F,{"show-index":"",headers:i.headers,items:d.searchableItems,"search-value":i.searchValue,"search-field":i.searchField,"rows-per-page":500,"border-cell":"","buttons-pagination":""},{"empty-message":a(()=>[Z]),loading:a(()=>[ee]),"item-plafon":a(r=>[n("Rp. "+T(d.formatInput(r.plafon))+",-",1)]),"item-isApproved":a(r=>[parseInt(r.isApproved)==1?(p(),g("span",te," Approved")):k("",!0),parseInt(r.isApproved)==2?(p(),g("span",ae," Pending")):k("",!0),parseInt(r.isApproved)==3?(p(),g("span",se," Rejected")):k("",!0),parseInt(r.isApproved)==4?(p(),g("span",le," Cancel by Debitur")):k("",!0)]),"item-type":a(r=>[parseInt(r.type)==1?(p(),g("span",oe," Reguler")):k("",!0),parseInt(r.type)==2?(p(),g("span",ie," Restruktur")):(p(),g("span",re," -"))]),"item-aoro":a(r=>[h("span",null,T(r.user.name),1)]),"item-slik":a(r=>[d.hasSlikAttachment(r.attachments)?(p(),_(S,{key:0,location:"top",text:"Kondisi SLIK Sudah Terupload"},{activator:a(({props:c})=>[h("span",b(A(c)),[s(m,{color:"success"},{default:a(()=>[n("mdi-check-circle")]),_:1})],16)]),_:1})):(p(),_(S,{key:1,location:"top",text:"Kondisi SLIK Belum Terupload"},{activator:a(({props:c})=>[h("span",b(A(c)),[s(m,{color:"error"},{default:a(()=>[n("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-analisaAO":a(r=>[d.hasAnalisaAoAttachment(r.attachments)?(p(),_(S,{key:0,location:"top",text:"Analisa AO Sudah Terupload"},{activator:a(({props:c})=>[h("span",b(A(c)),[s(m,{color:"success"},{default:a(()=>[n("mdi-check-circle")]),_:1})],16)]),_:1})):(p(),_(S,{key:1,location:"top",text:"Analisa AO Belum Terupload"},{activator:a(({props:c})=>[h("span",b(A(c)),[s(m,{color:"error"},{default:a(()=>[n("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-created_at":a(r=>[h("span",null,T(d.formatDate(r.created_at))+" WIB",1)]),"item-operation":a(r=>[h("div",ne,[h("div",de,[s(S,{location:"top",text:"Detail Kredit"},{activator:a(({props:c})=>[h("button",P(c,{onClick:M=>d.toDetail(r)}),[s(m,{size:"20",icon:"bx-link-external",color:"blue"})],16,ue)]),_:2},1024),s(S,{location:"top",text:"Download Semua File Kredit"},{activator:a(({props:c})=>[h("button",P(c,{onClick:M=>d.downloadFile(r.id)}),[s(m,{size:"20",icon:"bx-download",color:"red"})],16,pe)]),_:2},1024)])])]),_:1},8,["headers","items","search-value","search-field"])],32)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),s(I,{modelValue:i.insert,"onUpdate:modelValue":t[9]||(t[9]=u=>i.insert=u),"order-list":i.orderList,"status-credit-list":i.statusCreditList,"close-modal":d.closeModal},null,8,["modelValue","order-list","status-credit-list","close-modal"])]),_:1})]),_:1})}const Ne=B(Q,[["render",he],["__scopeId","data-v-d3d12e51"]]);export{Ne as default};
