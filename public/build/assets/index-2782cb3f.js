import{m as b}from"./axios-379d51f3.js";import{I as O}from"./insertKredit-d1aeabd1.js";import{_ as C,r as w,o as n,i as m,w as s,a,f as u,c as h,G as F,e as N,j as f,h as _,b as d,t as y,L as S,M as I,O as k,d as T,H as K,I as L,J as B}from"./main-759cb87b.js";import{V as P,c as M,b as U}from"./VCard-52223027.js";import{V as x}from"./VSpacer-3e0b024d.js";import{a as v,V as j}from"./VTabs-7f036863.js";import{V as G,a as W}from"./VWindowItem-77d73067.js";import{V as z}from"./VRow-7c3bab50.js";import{V as H}from"./VTextField-06e2cde8.js";import{V as g}from"./VTooltip-d4792dab.js";import"./VDialog-8e0db9e1.js";import"./forwardRefs-8348545e.js";import"./dialog-transition-9f9f470a.js";import"./VForm-bcf32498.js";import"./VInput-e8b396b8.js";import"./index-b36c4722.js";import"./VSelect-c0a0589e.js";import"./VMenu-5cea52e6.js";import"./VAvatar-a86fd93f.js";import"./VImg-257b2f41.js";import"./VChip-28e03063.js";import"./VFileInput-6bc0e2b3.js";import"./VCheckbox-c08f91b8.js";const q={inject:["loading"],components:{InsertModal:O},computed:{searchableItems(){return this.items.map(e=>({...e,office_names:e.user.position.offices.map(t=>t.name).join(", ")}))}},data(){return{selectedOption:"bukuNikah",selectedPhoto:"",overlay:!1,insert:!1,searchValue:"",userData:null,userToken:null,uploadProgress:null,tab:0,rules:{required:e=>!!e||"Required"},role:{canDownload:0},items:[],originalItems:[],userAccess:null,headers:[{text:"Nama",value:"name",sortable:!0},{text:"Plafon",value:"plafon",sortable:!0},{text:"Tipe",value:"type",sortable:!0},{text:"Status",value:"isApproved",sortable:!0},{text:"AO/RO",value:"aoro",sortable:!0},{text:"Kantor",value:"office_names",sortable:!0},{text:"Tanggal",value:"created_at",sortable:!0},{text:"SLIK",value:"slik",sortable:!1},{text:"Analisa AO/RO",value:"analisaAO",sortable:!1},{text:"Aksi",value:"operation",width:100}],phases:[{value:0},{value:1},{value:2},{value:3},{value:4},{value:5},{value:6},{value:7}],searchField:["name","plafon","phase","type_bussiness","desc_bussiness","reasonRejected","nik_pemohon","nik_pasangan","nik_jaminan","address","no_hp","order_source","status_kredit","user.name","user.position.name","office_names"],orderList:[{value:"AO SENDIRI",title:"AO SENDIRI"},{value:"C. SERVIS / KANTOR",title:"C. SERVIS / KANTOR"},{value:"NASABAH",title:"NASABAH"},{value:"CROSS SALING DIVISI",title:"CROSS SALING DIVISI"},{value:"AGEN MGM / LAINNYA",title:"AGEN MGM / LAINNYA"},{value:"WEBSITE / WA / SOSMED",title:"WEBSITE / WA/ SOSMED"},{value:"TEAM BUSSINES",title:"TEAM BUSSINES"},{value:"PROGRAM KKB NEW",title:"PROGRAM KKB NEW"},{value:"PROGRAM KKB SECOND",title:"PROGRAM KKB SECOND"},{value:"CENTRO",title:"CENTRO"}],statusCreditList:[{value:"FRESH",title:"FRESH"},{value:"REPEAT ORDER",title:"REPEAT ORDER"},{value:"TOPUP",title:"TOPUP"}],isStatusPhase:!1,statusPhase:0}},watch:{tab(e){e==1?this.filterDataStatus(1):e==2?this.filterDataStatus(2):e==3?this.filterDataStatus(3):e==4?this.filterDataStatus(4):e==5?this.filterDataStatus(5):e==6?this.filterDataStatus(6):e==7?this.filterDataStatus(7):this.items=[...this.originalItems]}},methods:{filterDataStatus(e){const t={1:l=>l.isApproved==1,2:l=>l.isApproved==2,3:l=>l.isApproved==3,4:l=>parseInt(l.phase)==1,5:l=>l.attachments.some(r=>r.name.includes("SLIK")&&parseInt(r.phase)==2&&(r.path!="null"||r.link!=null)),6:l=>parseInt(l.phase)==4,7:l=>l.isApproved==4};this.items=e in t?this.originalItems.filter(t[e]):[...this.originalItems]},hasSlikAttachment(e){return e.some(t=>t.name.includes("SLIK")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},hasAnalisaAoAttachment(e){return e.some(t=>t.name.includes("Analisa Awal Kredit AO")&&parseInt(t.phase)==2&&(t.path!="null"||t.link!=null))},customSearch(e,t,l){return t?e.filter(r=>l.some(i=>i==="user.position.offices.name"?r.user.position.offices.some(c=>c.name.toLowerCase().includes(t.toLowerCase())):String(this.getNestedValue(r,i)).toLowerCase().includes(t.toLowerCase()))):e},getNestedValue(e,t){return t.split(".").reduce((l,r)=>l&&l[r]!==void 0?l[r]:null,e)},async toPage(){this.loading.show(),await this.$nextTick(),this.$router.push("/u-indexfilter")},formatDate(e){return new Date(e).toLocaleString("id-ID")},async downloadFile(e){try{this.loading.show();const t=await b.get(`/download-all/${e}`,{responseType:"blob"});if(t.status===200){this.loading.hide();const l=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=l,r.setAttribute("download",`${e}.zip`),document.body.appendChild(r),r.click(),document.body.removeChild(r),this.$showToast("success","Berhasil","File berhasil diunduh")}else this.loading.hide(),this.$showToast("error","Error","Gagal mengunduh file")}catch{this.loading.hide(),this.$showToast("error","Error","Terjadi kesalahan saat mengunduh file")}},formatInput(e){return e=e.replace(/\D/g,""),e=e.replace(/\B(?=(\d{3})+(?!\d))/g,","),e},toDetail(e){this.$router.push(`/u-credit/${e.id}`)},async deleteFile(e){try{if(this.loading.show(),!window.confirm("Apakah Anda yakin ingin menghapus data? Semua Data akan terhapus secara permanen."))return;const l=await b.delete(`/user/credit/${e.id}`);l.status===200?(this.loading.hide(),this.getAllFiles(),this.$showToast("success","Berhasill",l.data.message)):(this.loading.hide(),this.getAllFiles(),this.$showToast("error","Sorry",l.data.message))}catch(t){this.loading.hide(),this.getAllFiles(),this.$showToast("error","Sorry",t.response.data.message)}},resetFile(e){!this.dataForm[e]!=null&&(this.dataForm[e]=null)},async openModal(e,t=null){e===1&&(this.insert=!0)},closeModal(e){e===1?(this.resetForm(),this.insert=!1):e===2&&(this.resetForm(),this.edit=!1)},resetForm(){this.dataForm={id:null,name:"",plafon:null,order_source:null,status_kredit:null,file1:null,hasFile2:!1,file2:null,hasFile3:!1,file3:null,file4:null,file5:null,hasFile7:!1,file7:null,hasFile8:!1,file8:null,hasFile9:!1,file9:null,hasFile10:!1,file10:null}},getUserData(){const e=localStorage.getItem("userData");e&&(this.userData=JSON.parse(e))},async getAllFiles(){try{const e=await b.get("/user/credit");e.status===200?(this.items=e.data.data.files,this.userAccess=e.data.data.userAccess,this.role=e.data.data.role,this.originalItems=[...this.items]):this.$showToast("error","Sorry",e.data.data.message)}catch(e){this.$showToast("error","Sorry",e.response.data.message)}}},async mounted(){try{this.loading.show(),await Promise.all([this.getAllFiles(),this.getUserData()])}catch(e){console.error("Error in mounted:",e)}finally{this.loading.hide()}}};const R=e=>(L("data-v-0402fb09"),e=e(),B(),e),J=R(()=>d("p",null,"Data Kosong",-1)),Y=R(()=>d("p",null,"loading data .....",-1)),Q={key:0},X={key:1},Z={key:2},$={key:3},ee={key:0},te={key:1},se={key:2},ae={class:"operation-wrapper"},le={class:"d-flex justify-space-between"},oe=["onClick"],ie=["onClick"],re=["onClick"];function ne(e,t,l,r,i,c){const V=w("EasyDataTable"),E=w("InsertModal");return n(),m(P,null,{default:s(()=>[a(M,{class:"text-2xl font-weight-bold d-flex justify-left"},{default:s(()=>[u(" List Kredit Bulan ini "),a(x)]),_:1}),a(j,{modelValue:i.tab,"onUpdate:modelValue":t[0]||(t[0]=A=>i.tab=A),class:"v-tabs-pill","bg-color":"secondary"},{default:s(()=>[a(v,{value:"0"},{default:s(()=>[u("Semua")]),_:1}),a(v,{value:"1"},{default:s(()=>[u("Approved")]),_:1}),a(v,{value:"2"},{default:s(()=>[u("Pending")]),_:1}),a(v,{value:"3"},{default:s(()=>[u("Rejected")]),_:1}),a(v,{value:"7"},{default:s(()=>[u("Cancel by Debitur")]),_:1}),u(" | "),a(v,{value:"4"},{default:s(()=>[u("Pooling")]),_:1}),a(v,{value:"5"},{default:s(()=>[u("SLIK")]),_:1}),a(v,{value:"6"},{default:s(()=>[u("Komite")]),_:1})]),_:1},8,["modelValue"]),a(U,null,{default:s(()=>[a(G,{modelValue:i.tab,"onUpdate:modelValue":t[5]||(t[5]=A=>i.tab=A)},{default:s(()=>[(n(!0),h(K,null,F(i.phases,A=>(n(),m(W,{value:A.value},{default:s(()=>[a(z,{class:"d-flex justify-end pa-3 mb-1"},{default:s(()=>[i.userAccess&&parseInt(i.userAccess.canInsertData)?(n(),m(N,{key:0,color:"primary",size:"small",class:"my-3 mx-3",onClick:t[1]||(t[1]=o=>c.openModal(1))},{default:s(()=>[a(f,{icon:"mdi-plus"}),u("Tambah Data ")]),_:1})):_("",!0),a(x),a(H,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:i.searchValue,"onUpdate:modelValue":t[2]||(t[2]=o=>i.searchValue=o)},null,8,["modelValue"])]),_:1}),d("div",{class:"table-container",onTouchstart:t[3]||(t[3]=T(()=>{},["stop"])),onTouchmove:t[4]||(t[4]=T(()=>{},["stop"]))},[a(V,{"show-index":"",headers:i.headers,items:c.searchableItems,"search-value":i.searchValue,"search-field":i.searchField,"border-cell":"","buttons-pagination":"","rows-per-page":500},{"empty-message":s(()=>[J]),loading:s(()=>[Y]),"item-plafon":s(o=>[u("Rp. "+y(c.formatInput(o.plafon))+",-",1)]),"item-isApproved":s(o=>[parseInt(o.isApproved)==1?(n(),h("span",Q," Approved")):_("",!0),parseInt(o.isApproved)==2?(n(),h("span",X," Pending")):_("",!0),parseInt(o.isApproved)==3?(n(),h("span",Z," Rejected")):_("",!0),parseInt(o.isApproved)==4?(n(),h("span",$," Cancel by Debitur")):_("",!0)]),"item-type":s(o=>[parseInt(o.type)==1?(n(),h("span",ee," Reguler")):_("",!0),parseInt(o.type)==2?(n(),h("span",te," Restruktur")):(n(),h("span",se," -"))]),"item-aoro":s(o=>[d("span",null,y(o.user.name),1)]),"item-created_at":s(o=>[d("span",null,y(c.formatDate(o.created_at))+" WIB",1)]),"item-slik":s(o=>[c.hasSlikAttachment(o.attachments)?(n(),m(g,{key:0,location:"top",text:"Kondisi SLIK Sudah Terupload"},{activator:s(({props:p})=>[d("span",S(I(p)),[a(f,{color:"success"},{default:s(()=>[u("mdi-check-circle")]),_:1})],16)]),_:1})):(n(),m(g,{key:1,location:"top",text:"Kondisi SLIK Belum Terupload"},{activator:s(({props:p})=>[d("span",S(I(p)),[a(f,{color:"error"},{default:s(()=>[u("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-analisaAO":s(o=>[c.hasAnalisaAoAttachment(o.attachments)?(n(),m(g,{key:0,location:"top",text:"Analisa AO Sudah Terupload"},{activator:s(({props:p})=>[d("span",S(I(p)),[a(f,{color:"success"},{default:s(()=>[u("mdi-check-circle")]),_:1})],16)]),_:1})):(n(),m(g,{key:1,location:"top",text:"Analisa AO Belum Terupload"},{activator:s(({props:p})=>[d("span",S(I(p)),[a(f,{color:"error"},{default:s(()=>[u("mdi-close-circle")]),_:1})],16)]),_:1}))]),"item-operation":s(o=>[d("div",ae,[d("div",le,[a(g,{location:"top",text:"Detail Kredit"},{activator:s(({props:p})=>[d("button",k(p,{onClick:D=>c.toDetail(o)}),[a(f,{size:"20",icon:"bx-link-external",color:"blue"})],16,oe)]),_:2},1024),i.userData&&o.user_id==i.userData.id?(n(),m(g,{key:0,location:"top",text:"Hapus Kredit"},{activator:s(({props:p})=>[d("button",k(p,{onClick:D=>c.deleteFile(o)}),[a(f,{size:"20",icon:"bx-trash",color:"red"})],16,ie)]),_:2},1024)):_("",!0),i.role&&i.role.canDownload==1?(n(),m(g,{key:1,location:"top",text:"Download Semua File Kredit"},{activator:s(({props:p})=>[d("button",k(p,{onClick:D=>c.downloadFile(o.id)}),[a(f,{size:"20",icon:"bx-download",color:"red"})],16,re)]),_:2},1024)):_("",!0)])])]),_:1},8,["headers","items","search-value","search-field"])],32)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(E,{modelValue:i.insert,"onUpdate:modelValue":t[6]||(t[6]=A=>i.insert=A),"order-list":i.orderList,"status-credit-list":i.statusCreditList,"close-modal":c.closeModal,"get-all-files":c.getAllFiles},null,8,["modelValue","order-list","status-credit-list","close-modal","get-all-files"])]),_:1})}const Oe=C(q,[["render",ne],["__scopeId","data-v-0402fb09"]]);export{Oe as default};
